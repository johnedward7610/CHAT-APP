<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Firebase Auth With Profile</title>

<style>
  body{
    background: #BCC0E8;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
    font-family: Arial, sans-serif;
  }
  .card{
    background: white;
    width: 350px;
    padding: 25px;
    border-radius: 20px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h2{
    margin-bottom: 10px;
  }
  input, select{
    background: hsla(235, 0%, 90%, 1);
    border: none;
    height: 40px;
    width: 90%;
    border-radius: 20px;
    margin: 10px 0;
    padding: 10px;
    outline: none;
    font-size: 14px;
  }
  button{
    width: 90%;
    height: 40px;
    background: #3b49df;
    color: white;
    border-radius: 20px;
    border: none;
    margin-top: 10px;
    cursor: pointer;
    font-size: 15px;
  }
  button:hover{
    background: #2e3ac7;
  }
  .switch{
    cursor: pointer;
    color: #3b49df;
    text-align: center;
    font-size: 14px;
    margin-top: 10px;
  }
  #msg, #msg2{
    text-align: center;
    color: red;
    margin-top: 5px;
    font-size: 14px;
  }
</style>

</head>
<body>

<div class="card">

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>Login</h2>

    <input id="loginEmail" type="email" placeholder="Email">
    <input id="loginPass" type="password" placeholder="Password">

    <button id="loginBtn">Login</button>

    <p class="switch" onclick="showSignup()">Create an account</p>
    <p id="msg"></p>
  </div>

  <!-- SIGNUP -->
  <div id="signupBox" style="display:none;">
    <h2>Sign Up</h2>

    <input id="signupEmail" type="email" placeholder="Email">
    <input id="signupPass" type="password" placeholder="Password">
    <input id="signupUsername" type="text" placeholder="Username">

    <select id="signupGender">
      <option value="">Select Gender</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
      <option value="other">Other</option>
    </select>

    <button id="signupBtn">Create Account</button>

    <p class="switch" onclick="showLogin()">Already have an account?</p>
    <p id="msg2"></p>
  </div>

</div>


<script type="module">

  /* âœ… Correct Firebase CDN Imports */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
  import { 
    getAuth,
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword
  } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

  import {
    getFirestore,
    doc,
    setDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";


  /* ðŸ”¥ Your Firebase Config */
  const firebaseConfig = {
    apiKey: "AIzaSyDXXQvWziaNYaStkNkDjDclNxrVa_7qYX8",
    authDomain: "chat-34ff3.firebaseapp.com",
    projectId: "chat-34ff3",
    storageBucket: "chat-34ff3.firebasestorage.app",
    messagingSenderId: "391966829170",
    appId: "1:391966829170:web:2b9fa454e8be176b7930eb",
    measurementId: "G-81MNVPKD3W"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);


  /* ðŸ”„ SWITCH BETWEEN LOGIN & SIGNUP */
  window.showSignup = () => {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("signupBox").style.display = "block";
  };

  window.showLogin = () => {
    document.getElementById("signupBox").style.display = "none";
    document.getElementById("loginBox").style.display = "block";
  };


  /* ðŸ” LOGIN */
  document.getElementById("loginBtn").onclick = () => {
    const email = document.getElementById("loginEmail").value;
    const pass = document.getElementById("loginPass").value;

    signInWithEmailAndPassword(auth, email, pass)
      .then(() => {
        window.location.href = "/homepage.html"; // redirect
      })
      .catch(err => document.getElementById("msg").innerText = err.message);
  };


  /* ðŸ“ SIGNUP */
  document.getElementById("signupBtn").onclick = async () => {

    const email = document.getElementById("signupEmail").value;
    const pass = document.getElementById("signupPass").value;
    const username = document.getElementById("signupUsername").value;
    const gender = document.getElementById("signupGender").value;
    const msg2 = document.getElementById("msg2");

    if (!email || !pass || !username || !gender) {
      msg2.innerText = "Please fill out all fields";
      return;
    }

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, pass);
      const uid = userCred.user.uid;

      await setDoc(doc(db, "users", uid), {
        email: email,
        username: username,
        gender: gender,
        createdAt: serverTimestamp()
      });

      msg2.style.color = "green";
      msg2.innerText = "Account created!";

      setTimeout(() => {
        window.location.href = "/homepage.html";
      }, 800);

    } catch (err) {
      msg2.innerText = err.message;
    }
  };

</script>

</body>
  </html>
