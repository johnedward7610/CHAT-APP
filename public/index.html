<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Google Login Test</title>
</head>
<body>
<button id="google-login">Sign in with Google</button>
<div id="user-info"></div>

<script src="https://www.gstatic.com/firebasejs/10.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.24.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.24.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDXXQvWziaNYaStkNkDjDclNxrVa_7qYX8",
  authDomain: "chat-34ff3.firebaseapp.com",
  databaseURL: "https://chat-34ff3-default-rtdb.firebaseio.com",
  projectId: "chat-34ff3",
  storageBucket: "chat-34ff3.appspot.com",
  messagingSenderId: "391966829170",
  appId: "1:391966829170:web:2b9fa454e8be176b7930eb",
  measurementId: "G-81MNVPKD3W"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const database = firebase.database();

const loginButton = document.getElementById('google-login');
const userInfoDiv = document.getElementById('user-info');

loginButton.addEventListener('click', () => {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then((result) => {
      const user = result.user;
      userInfoDiv.innerHTML = `Welcome, ${user.displayName} (${user.email})`;

      database.ref('users/' + user.uid).set({
        name: user.displayName,
        email: user.email,
        lastLogin: new Date().toISOString()
      });
    })
    .catch(err => alert('Login failed: ' + err.message));
});

auth.onAuthStateChanged(user => {
  if(user){
    userInfoDiv.innerHTML = `Welcome back, ${user.displayName} (${user.email})`;
  }
});
</script>
</body>
</html>
