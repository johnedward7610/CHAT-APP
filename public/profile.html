<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>All Users</title>
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:Inter,sans-serif;background:#f4f6ff;color:#1b1b1b;transition:0.3s;}
body.dark{background:#0f1117;color:#fff;}
.container{padding:20px;}
.user{padding:12px 16px;margin-bottom:10px;border-radius:8px;background:#fff;cursor:pointer;transition:0.2s;box-shadow:0 3px 10px rgba(0,0,0,0.05);}
.user:hover{background:#e1e6ff;}
.theme-toggle{position:fixed;top:14px;right:14px;background:transparent;border:none;font-size:22px;cursor:pointer;}
.message{padding:12px 16px;margin-top:20px;background:#fff;border-radius:8px;text-align:center;box-shadow:0 3px 10px rgba(0,0,0,0.05);}
</style>
</head>
<body>
<button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
<h2 style="text-align:center;margin-top:40px;">All Users</h2>
<div class="container" id="usersList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDXXQvWziaNYaStkNkDjDclNxrVa_7qYX8",
  authDomain: "chat-34ff3.firebaseapp.com",
  projectId: "chat-34ff3",
  storageBucket: "chat-34ff3.appspot.com",
  messagingSenderId: "391966829170",
  appId: "1:391966829170:web:2b9fa454e8be176b7930eb",
  measurementId: "G-81MNVPKD3W"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const auth = getAuth(app);

// Theme Toggle
const themeToggle = document.getElementById("themeToggle");
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  themeToggle.textContent = document.body.classList.contains("dark") ? "â˜€" : "ðŸŒ™";
});

// Users Display
const usersList = document.getElementById("usersList");
let currentUser = null;

function showMessage(msg) {
  usersList.innerHTML = `<div class="message">${msg}</div>`;
}

onAuthStateChanged(auth, user => {
  if(user) {
    currentUser = user;
    loadUsers();
  } else {
    // Not logged in â†’ redirect to login
    window.location.href = "login.html";
  }
});

function loadUsers() {
  onSnapshot(collection(db, "users"), snapshot => {
    if(snapshot.empty) {
      showMessage("No users found.");
      return;
    }

    usersList.innerHTML = "";
    let displayed = 0;

    snapshot.docs.forEach(doc => {
      if(currentUser && doc.id === currentUser.uid) return; // skip self
      const fullName = doc.data().fullName || "(No name)";
      const email = doc.data().email || "(No email)";
      const div = document.createElement("div");
      div.className = "user";
      div.textContent = fullName + " (" + email + ")";
      usersList.appendChild(div);
      displayed++;
    });

    if(displayed === 0) {
      showMessage("No other users found.");
    }
  }, err => {
    console.error("Error loading users:", err);
    showMessage("Error loading users. Check console for details.");
  });
}
</script>
</body>
</html>
