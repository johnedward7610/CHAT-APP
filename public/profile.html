<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZYNK - Profile</title>
<style>
  body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    background: #BCC0E8;
  }
  .Header {
    width: 100%;
    height: 5rem;
    background-color: #BCC0E8;
    border-radius: 0px 0px 20px 20px;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .body {
    width: 90%;
    max-width: 500px;
    margin: 20px auto;
    background: white;
    border-radius: 20px;
    padding: 20px;
  }
  .avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: #dcdcff;
    margin-bottom: 15px;
  }
  h2 {
    margin: 5px 0;
  }
  .followers-list {
    margin-top: 15px;
  }
  .followers-list div {
    padding: 5px;
    border-bottom: 1px solid #eee;
  }
</style>
</head>
<body>

<div class="Header">
  <h1>Profile</h1>
</div>

<div class="body" id="profileContainer">
  <div class="avatar"></div>
  <h2 id="username">Username</h2>
  <p id="gender">Gender</p>
  <p>Followers: <span id="followersCount">0</span></p>
  <div class="followers-list" id="followersList"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDXXQvWziaNYaStkNkDjDclNxrVa_7qYX8",
    authDomain: "chat-34ff3.firebaseapp.com",
    projectId: "chat-34ff3",
    storageBucket: "chat-34ff3.firebasestorage.app",
    messagingSenderId: "391966829170",
    appId: "1:391966829170:web:2b9fa454e8be176b7930eb",
    measurementId: "G-81MNVPKD3W"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const usernameEl = document.getElementById("username");
  const genderEl = document.getElementById("gender");
  const followersCountEl = document.getElementById("followersCount");
  const followersListEl = document.getElementById("followersList");

  // Get userId from URL
  const urlParams = new URLSearchParams(window.location.search);
  const userId = urlParams.get("id");

  if (!userId) {
    alert("No user ID provided");
    window.location.href = "/homepage.html";
  }

  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "/login.html";
      return;
    }

    try {
      // Load user profile
      const userDoc = await getDoc(doc(db, "users", userId));
      if (!userDoc.exists()) {
        alert("User not found");
        window.location.href = "/homepage.html";
        return;
      }

      const userData = userDoc.data();
      usernameEl.innerText = userData.username || "Unknown";
      genderEl.innerText = userData.gender || "Unknown";
      followersCountEl.innerText = userData.followers || 0;

      // Optional: show followers list if you store who followed
      if (userData.followedBy && Array.isArray(userData.followedBy)) {
        followersListEl.innerHTML = "<h4>Followers:</h4>";
        userData.followedBy.forEach(follower => {
          const div = document.createElement("div");
          div.innerText = follower;
          followersListEl.appendChild(div);
        });
      }

    } catch(err) {
      alert("Error loading profile: " + err.message);
    }
  });
</script>

</body>
</html>
